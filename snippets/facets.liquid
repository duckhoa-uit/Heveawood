{% comment %}
  	Renders facets (filtering and sorting)

  	Accepts:
  	- results: {Object} Collection or Search object
  	- enable_filtering: {Boolean} Show filtering when true
  	- enable_sorting: {Boolean} Show sorting when true

  	Usage:
  {% render 'facets', results: collection, enable_filtering: true, enable_sorting: true %}
{% endcomment %}

{%- liquid
  assign sort_by = results.sort_by | default: results.default_sort_by
  assign total_active_values = 0
  if results.url
    assign results_url = results.url
  else
    assign terms = results.terms | escape
    assign results_url = '?q=' | append: terms | append: '&options%5Bprefix%5D=last&sort_by=' | append: sort_by
  endif
-%}

<div class="facets-container{% if enable_filtering == false and enable_sorting == false %} facets-container_no-filter{% endif %}{% if filter_type == 'drawer' %} facets-container--drawer{% endif %}">
  <facet-filters-form class="facets small-hide medium-hide">
    <form
      id="FacetFiltersForm"
      class="facets__form"
    >
      {%- if results.terms -%}
        <input type="hidden" name="q" value="{{ results.terms | escape }}">
        <input name="options[prefix]" type="hidden" value="last">
      {%- endif -%}

      {% if enable_filtering or enable_sorting %}
        <div class="facets__container">
          {%- if enable_filtering -%}
            {%- if filter_type == 'drawer' -%}
              <button type="button" class="button button--unstyled facets-button-show no-js-hidden focus-inset">
                {% render 'icon-filter' %}
                <span>{{- 'products.facets.show_filters' | t -}}</span>
              </button>

              <div class="facets-mask color-background-3"></div>
            {%- endif -%}

            <div
              id="FacetsWrapperDesktop"
              class="facets__wrapper"
            >
              {%- if filter_type == 'drawer' -%}
                <div class="facets__wrapper-top">
                  <span class="facets__wrapper-heading h3">
                    {{- 'products.facets.filters_drawer_header' | t -}}
                  </span>
                  <button
                    class="facets__wrapper-close modal-close-button focus-inset"
                    aria-label="{{- 'products.facets.hide_filters' | t -}}"
                  >
                    {% render 'icon-close' %}
                  </button>
                </div>
              {%- endif -%}

              {%- for filter in results.filters -%}
                {% liquid
                  assign presentation = filter.presentation | default: default_presentation
                %}
                {%- assign total_active_values = total_active_values | plus: filter.active_values.size -%}
                {% case filter.type %}
                  {% when 'boolean', 'list' %}
                    {% liquid
                      assign color_swatch = false
                      assign color_trigger = settings.trigger_swatch | append: '<br />' | append: settings.trigger_swatch_other | strip | newline_to_br | split: '<br />'
                      assign name_option = filter.label | handle | strip

                      for item in color_trigger
                        assign item_temp = item | handle | strip
                        if name_option == item_temp
                          assign color_swatch = true
                        endif
                      endfor
                    %}
                    <details
                      id="Details-{{ forloop.index }}-{{ section.id }}"
                      class="disclosure-has-popup facets__disclosure js-filter"
                      data-index="{{ forloop.index }}"
                      open
                    >
                      <summary class="facets__summary focus-inset">
                        <div class="facets__summary-inner">
                          <span class="facets__summary-title font-weight-bold">
                            {{ filter.label | escape }}
                          </span>
                          <facet-remove>
                            <a
                              href="{{ filter.url_to_remove }}"
                              class="facets__reset button button--small button--tertiary focus-inset"
                              aria-label="{{ 'products.facets.reset' | t }}"
                            >
                              <span>{{ 'products.facets.reset' | t }}</span>
                            </a>
                          </facet-remove>
                        </div>
                      </summary>
                      <div
                        id="Facet-{{ forloop.index }}-{{ section.id }}"
                        class="facets__display"
                      >
                        <ul
                          class="facets__list list-unstyled{% if settings.type_color_swatch == 'custom' and color_swatch %} facets__list--color{% elsif settings.type_color_swatch == 'standart' and presentation == 'swatch' %} facets__list--color{% elsif presentation == 'image' %} facets__list--image{% endif %}"
                          role="list"
                          style="--image_filter_columns: {{ image_filter_columns }};"
                        >
                          {%- for value in filter.values -%}
                            {% liquid
                              if settings.type_color_swatch == 'custom' and color_swatch
                                assign color_value = value.label | handle | strip
                                assign color_value_custom = color_value
                                assign has_custom_gradient = false

                                if settings.custom_colors != blank
                                  assign custom_colors_string = settings.custom_colors | strip
                                  assign custom_colors_obj = custom_colors_string | newline_to_br | split: '<br />'

                                  for obj in custom_colors_obj
                                    assign obj_strip = obj | strip
                                    assign obj_key = obj_strip | split: ':' | first
                                    assign obj_value = obj_strip | split: ':' | last
                                    assign obj_color_name = obj_key | handle | strip

                                    if color_value == obj_color_name
                                      assign obj_color_value = obj_value
                                      if obj_color_value contains 'gradient'
                                        assign has_custom_gradient = true
                                        assign color_value_custom = obj_color_value
                                      else
                                        assign color_value_custom = obj_color_value | strip | remove: '-'
                                      endif
                                      break
                                    endif
                                  endfor
                                endif
                              endif

                              assign swatch_value = null
                              if presentation == 'swatch'
                                assign swatch = value.swatch
                                if swatch.image
                                  assign image_url = swatch.image | image_url: width: 50
                                  assign swatch_value = 'url(' | append: image_url | append: ')'
                                  assign swatch_focal_point = swatch.image.presentation.focal_point
                                elsif swatch.color
                                  assign swatch_value = 'rgb(' | append: swatch.color.rgb | append: ')'
                                endif
                              endif
                            %}
                            {% liquid
                              if color_value_custom == 'white' or color_value_custom == '#fff' or color_value_custom == '#ffffff' or color_value_custom == '255,255,255' or color_value_custom == '255,255,255,1' or swatch_value == 'rgb(255 255 255)'
                                assign is_white = true
                              else
                                assign is_white = false
                              endif

                              if color_value_custom == 'black' or color_value_custom == '#000' or color_value_custom == '#000000' or color_value_custom == '0,0,0' or color_value_custom == '0,0,0,1' or swatch_value == 'rgb(0 0 0)'
                                assign is_black = true
                              else
                                assign is_black = false
                              endif
                            %}
                            <li
                              class="list-menu__item facets__item{% if settings.type_color_swatch == 'custom' and color_swatch %} facets__item--color{% elsif settings.type_color_swatch == 'standart' and presentation == 'swatch' %} facets__item--color{% elsif presentation == 'image' %} facets__item--image{% endif %}"
                              {% if settings.type_color_swatch == 'custom' and color_swatch %}
                                style="--swatch-color: {{ color_value_custom }}"
                              {% elsif settings.type_color_swatch == 'standart' and presentation == 'swatch' %}
                                style="--swatch-color: {{ swatch_value }}; {% if swatch_focal_point %} --swatch-focal-point: {{ swatch_focal_point }};{% endif %}"
                              {% endif %}
                            >
                              <input
                                type="checkbox"
                                class="focus-inset"
                                name="{{ value.param_name }}"
                                value="{{ value.value }}"
                                id="Filter-{{ filter.label | escape }}-{{ forloop.index }}"
                                {% if value.active %}
                                  checked
                                {% endif %}
                                {% if value.count == 0 and value.active == false %}
                                  disabled
                                {% endif %}
                              >
                              <label
                                for="Filter-{{ filter.label | escape }}-{{ forloop.index }}"
                                class="facet-checkbox{% if value.count == 0 and value.active == false %} facet-checkbox--disabled{% endif %}{% if settings.type_color_swatch == 'custom' and color_swatch %} facet-checkbox--color{% if has_custom_gradient %} color-gradient{% endif %}{% elsif settings.type_color_swatch == 'standart' and presentation == 'swatch' %} facet-checkbox--color facet-checkbox--standart{% elsif presentation == 'image' %} facet-checkbox--image{% endif %}{% if is_white %} color-white{% endif %}{% if is_black %} color-black{% endif %}"
                                {% if settings.type_color_swatch == 'custom' and color_swatch %}
                                  title="{{- value.label -}}"
                                {% elsif settings.type_color_swatch == 'standart' and presentation == 'swatch' %}
                                  title="{{- value.label -}}"
                                {% endif %}
                              >
                                {% if presentation == 'image' %}
                                  <div
                                    class="facets__image-wrapper"
                                    style="--image_filter_ratio: {{ image_filter_ratio }}; --image_filter_fit: {{ image_filter_fit }};"
                                  >
                                    {% liquid
                                      assign width = 1000 | divided_by: image_filter_columns
                                    %}
                                    {% if value.image %}
                                      {{
                                        value.image
                                        | image_url: width: width
                                        | image_tag: class: 'facets__image', alt: value.alt
                                      }}
                                    {% endif %}
                                  </div>
                                {% else %}
                                  <svg
                                    width="20"
                                    height="20"
                                    class="icon icon-checkmark"
                                    viewBox="0 0 20 20"
                                    fill="none"
                                    xmlns="http://www.w3.org/2000/svg"
                                  >
                                    <path d="M8.70186 13.3334L5.55566 10.1872L6.18626 9.55663L8.70186 12.0722L14.1073 6.66675L14.7379 7.29733L8.70186 13.3334Z" fill="currentColor" stroke="currentColor" stroke-width="0.5"/>
                                  </svg>
                                {% endif %}
                                <span class="facet-checkbox__label font-weight-medium{% if settings.type_color_swatch == 'custom' and color_swatch and settings.show_color_swatch_title %} color-swatch-title{% elsif settings.type_color_swatch == 'standart' and presentation == 'swatch' and settings.show_color_swatch_title %} color-swatch-title{% elsif settings.type_color_swatch == 'custom' and color_swatch %} visually-hidden{% elsif settings.type_color_swatch == 'standart' and presentation == 'swatch' %} visually-hidden{% endif %}">
                                  {{ value.label | escape }}
                                </span>
                              </label>
                            </li>
                          {%- endfor -%}
                        </ul>
                      </div>
                    </details>
                  {% when 'price_range' %}
                    {% liquid
                      assign currencies_using_comma_decimals = 'ANG,ARS,BRL,BYN,BYR,CLF,CLP,COP,CRC,CZK,DKK,EUR,HRK,HUF,IDR,ISK,MZN,NOK,PLN,RON,RUB,SEK,TRY,UYU,VES,VND' | split: ','
                      assign uses_comma_decimals = false
                      if currencies_using_comma_decimals contains cart.currency.iso_code
                        assign uses_comma_decimals = true
                      endif
                    %}

                    {% if filter.range_max != 0 %}
                      <details
                        id="Details-{{ forloop.index }}-{{ section.id }}"
                        class="disclosure-has-popup facets__disclosure facets__disclosure-price js-filter"
                        data-index="{{ forloop.index }}"
                        open
                      >
                        <summary class="facets__summary focus-inset">
                          <div class="facets__summary-inner">
                            <span class="facets__summary-title font-weight-bold">
                              {{ filter.label | escape }}
                            </span>
                            <facet-remove>
                              <a
                                href="{{ filter.url_to_remove }}"
                                class="facets__reset button button--small button--tertiary focus-inset link"
                                aria-label="{{ 'products.facets.reset' | t }}"
                              >
                                <span>{{ 'products.facets.reset' | t }}</span>
                              </a>
                            </facet-remove>
                          </div>
                        </summary>
                        <div
                          id="Facet-{{ forloop.index }}-{{ section.id }}"
                          class="facets__display"
                        >
                          <price-range class="facets__price">
                            {% liquid
                              if uses_comma_decimals
                                assign max_price = filter.range_max | money_without_currency | replace: '.', '' | replace: ',', '.'
                              else
                                assign max_price = filter.range_max | money_without_currency | replace: ',', ''
                              endif

                              if uses_comma_decimals
                                if filter.min_value.value
                                  assign current_price_min = filter.min_value.value | money_without_currency | replace: '.', '' | replace: ',', '.'
                                  assign range_min = current_price_min | divided_by: max_price | times: 100
                                else
                                  assign range_min = 0
                                  assign current_price_min = 0
                                endif
                              else
                                if filter.min_value.value
                                  assign current_price_min = filter.min_value.value | money_without_currency | replace: ',', ''
                                  assign range_min = current_price_min | divided_by: max_price | times: 100
                                else
                                  assign range_min = 0
                                  assign current_price_min = 0
                                endif
                              endif

                              if uses_comma_decimals
                                if filter.max_value.value
                                  assign current_price_max = filter.max_value.value | money_without_currency | replace: '.', '' | replace: ',', '.'
                                  assign range_max = current_price_max | divided_by: max_price | times: 100
                                else
                                  assign current_price_max = max_price
                                  assign range_max = 100
                                endif
                              else
                                if filter.max_value.value
                                  assign current_price_max = filter.max_value.value | money_without_currency | replace: ',', ''
                                  assign range_max = current_price_max | divided_by: max_price | times: 100
                                else
                                  assign current_price_max = max_price
                                  assign range_max = 100
                                endif
                              endif
                            %}

                            <div class="facets__price-wrapper">
                              <div class="field-wrapper">
                                <label
                                  class="font-weight-medium"
                                  for="Filter-{{ filter.label | escape }}-GTE"
                                >
                                  {{ 'products.facets.from' | t }}
                                </label>
                                <div class="field">
                                  <span class="field__currency">
                                    {{- cart.currency.symbol -}}
                                  </span>
                                  <input
                                    class="field__input"
                                    name="{{ filter.min_value.param_name }}"
                                    id="Filter-{{ filter.label | escape }}-GTE"
                                    {%- if filter.min_value.value -%}
                                      {%- if uses_comma_decimals -%}
                                        value="{{ filter.min_value.value | money_without_currency | replace: '.', '' | replace: ',', '.' }}"
                                      {%- else -%}
                                        value="{{ filter.min_value.value | money_without_currency | replace: ',', '' }}"
                                      {% endif %}
                                      {% comment %}
                                        {% else %}
                                        value="0"
                                      {% endcomment %}
                                    {%- endif -%}
                                    type="number"
                                    inputmode="numeric"
                                    step="1"
                                    placeholder="0"
                                    min="0"
                                    max="{{ filter.range_max | divided_by: 100 | ceil }}"
                                    {% comment %}
                                      {%- if uses_comma_decimals -%}
                                        max="{{ filter.range_max | money_without_currency | replace: '.', '' | replace: ',', '.' }}"
                                      {%- else -%}
                                        max="{{ filter.range_max | money_without_currency | replace: ',', '' }}"
                                      {% endif %}
                                    {% endcomment %}
                                  >
                                </div>
                              </div>
                              <div class="field-wrapper">
                                <label
                                  class="font-weight-medium"
                                  for="Filter-{{ filter.label | escape }}-LTE"
                                >
                                  {{ 'products.facets.to' | t }}
                                </label>
                                <div class="field">
                                  <span class="field__currency">
                                    {{- cart.currency.symbol -}}
                                  </span>
                                  <input
                                    class="field__input"
                                    name="{{ filter.max_value.param_name }}"
                                    id="Filter-{{ filter.label | escape }}-LTE"
                                    {%- if filter.max_value.value -%}
                                      {%- if uses_comma_decimals -%}
                                        value="{{ filter.max_value.value | money_without_currency | replace: '.', '' | replace: ',', '.' }}"
                                      {%- else -%}
                                        value="{{ filter.max_value.value | money_without_currency | replace: ',', '' }}"
                                      {%- endif %}
                                      {% comment %}
                                        {% else %}
                                        value="{{ current_price_max }}"
                                      {% endcomment %}
                                    {%- endif -%}
                                    type="number"
                                    inputmode="numeric"
                                    step="1"
                                    placeholder="{{ filter.range_max | divided_by: 100 | ceil }}"
                                    min="0"
                                    max="{{ filter.range_max | divided_by: 100 | ceil }}"
                                    {% comment %}
                                      {%- if uses_comma_decimals -%}
                                        placeholder="{{ filter.range_max | money_without_currency | replace: '.', '' | replace: ',', '.' }}"
                                        max="{{ filter.range_max | money_without_currency | replace: '.', '' | replace: ',', '.' }}"
                                      {%- else -%}
                                        placeholder="{{ filter.range_max | money_without_currency | replace: ',', '' }}"
                                        max="{{ filter.range_max | money_without_currency | replace: ',', '' }}"
                                      {% endif %}
                                    {% endcomment %}
                                  >
                                </div>
                              </div>
                            </div>

                            <div
                              class="facets__range"
                              style="--range-min: {{ range_min }}%; --range-max: {{ range_max }}%"
                            >
                              <label
                                class="visually-hidden"
                                for="Filter-{{ filter.label | escape }}-Min"
                              >
                                {{- 'products.facets.from' | t -}}
                              </label>
                              <input
                                type="range"
                                value="{{ current_price_min }}"
                                min="0"
                                max="{{ max_price }}"
                                class="field__range"
                                id="Filter-{{ filter.label | escape }}-Min"
                              >
                              <label
                                class="visually-hidden"
                                for="Filter-{{ filter.label | escape }}-Max"
                              >
                                {{- 'products.facets.to' | t -}}
                              </label>
                              <input
                                type="range"
                                value="{{ current_price_max }}"
                                min="0"
                                max="{{ max_price }}"
                                class="field__range"
                                id="Filter-{{ filter.label | escape }}-Max"
                              >
                            </div>
                          </price-range>
                        </div>
                      </details>
                    {% endif %}
                {% endcase %}
              {%- endfor -%}
            </div>
          {%- endif -%}

          {%- if enable_sorting -%}
            <div class="facets__sort-wrapper{% if enable_filtering == false %} facets__sort-wrapper_no-filter{% endif %}">
              <div class="facet-filters facets-sorting sorting">
                <label
                  class="facets-sorting__label font-weight-bold"
                  for="SortBy"
                >
                  {{ 'products.facets.sort_by_label' | t }}
                </label>
                <div class="facet-filters__field facets-sorting__field">
                  <div class="select field">
                    {%- assign sort_by = results.sort_by | default: results.default_sort_by -%}
                    <select
                      name="sort_by"
                      class="select__select"
                      id="SortBy"
                      aria-describedby="a11y-refresh-page-message"
                    >
                      {%- for option in results.sort_options -%}
                        <option
                          value="{{ option.value | escape }}"
                          {% if option.value == sort_by %}
                            selected="selected"
                          {% endif %}
                        >
                          {{ option.name | escape }}
                        </option>
                      {%- endfor -%}
                    </select>
                    {% render 'icon-caret' %}
                  </div>
                </div>
              </div>
            </div>
          {%- endif -%}

          {%- if enable_filtering -%}
            <div class="active-facets active-facets-desktop">
              {% assign active_facets = false %}
              {%- for filter in results.filters -%}
                {% if filter.active_values.size > 0
                  or filter.min_value.value != null
                  or filter.max_value.value != null
                %}
                  {% assign active_facets = true %}
                  {% break %}
                {% endif %}
              {% endfor %}

              <div class="active-facets__wrapper{% if active_facets %} active-facets__wrapper_margin{% endif %}">
                <div class="active-facets__items">
                  {%- for filter in results.filters -%}
                    {%- for value in filter.active_values -%}
                      <facet-remove>
                        <a
                          href="{{ value.url_to_remove }}"
                          class="active-facets__button focus-inset"
                          aria-label="{{ 'products.facets.reset' | t }}"
                        >
                          <span class="active-facets__button-inner">
                            <span class="active-facets__button-label font-weight-bold">
                              {{ value.label | escape }}
                            </span>
                            <span class="active-facets__button-close">
                              {%- render 'icon-close' -%}
                            </span>
                          </span>
                          <span class="visually-hidden">
                            {{- 'products.facets.clear_filter' | t -}}
                          </span>
                        </a>
                      </facet-remove>
                    {%- endfor -%}
                    {%- if filter.type == 'price_range' -%}
                      {%- if filter.min_value.value != null or filter.max_value.value != null -%}
                        <facet-remove>
                          <a
                            href="{{ filter.url_to_remove }}"
                            class="active-facets__button focus-inset"
                            aria-label="{{ 'products.facets.reset' | t }}"
                          >
                            <span class="active-facets__button-inner">
                              <span class="active-facets__button-label font-weight-bold">
                                {%- if filter.min_value.value -%}
                                  {{ filter.min_value.value | money }}
                                {%- else -%}
                                  {{ 0 | money }}
                                {%- endif -%}
                                -&nbsp;
                                {%- if filter.max_value.value -%}
                                  {{ filter.max_value.value | money }}
                                {%- else -%}
                                  {{ filter.range_max | money }}
                                {%- endif -%}
                              </span>
                              <span class="active-facets__button-close">
                                {%- render 'icon-close' -%}
                              </span>
                            </span>
                            <span class="visually-hidden">
                              {{- 'products.facets.clear_filter' | t -}}
                            </span>
                          </a>
                        </facet-remove>
                      {%- endif -%}
                    {%- endif -%}
                  {%- endfor -%}
                </div>
                {%- if active_facets -%}
                  <facet-remove class="active-facets__clear-btn">
                    <a
                      href="{{ results_url }}"
                      class="facets__reset button button--small button--tertiary focus-inset"
                      aria-label="{{ 'products.facets.clear_all' | t }}"
                    >
                      <span>{{ 'products.facets.clear_all' | t }}</span>
                    </a>
                  </facet-remove>
                {%- endif -%}
              </div>
            </div>
          {%- endif -%}

          <div class="facets__product-count" role="status">
            <span class="facets__product-count-text font-weight-medium">
              <span id="ProductCountDesktop">
                {%- if is_search -%}
                  {{- 'products.facets.product_count_simple' | t: count: results.results_count -}}
                {%- else -%}
                  {%- if results.products_count == results.all_products_count -%}
                    {{- 'products.facets.product_count_simple' | t: count: results.products_count -}}
                  {%- else -%}
                    {{-
                      'products.facets.product_count'
                      | t: product_count: results.products_count, count: results.all_products_count
                    -}}
                  {%- endif -%}
                {%- endif -%}
              </span>
            </span>
          </div>

          {%- if enable_filtering -%}
            <noscript>
              <button
                type="submit"
                class="facets__button button button--primary button--primary-size focus-inset"
                data-button-text="{{ 'products.facets.filter_button' | t }}"
              >
                <span>{{ 'products.facets.filter_button' | t }}</span>
              </button>
            </noscript>
          {%- endif -%}
          {%- if enable_sorting -%}
            <noscript>
              <button
                type="submit"
                class="facets__button button button--primary button--primary-size focus-inset"
                data-button-text="{{ 'products.facets.sort_button' | t }}"
              >
                <span>{{ 'products.facets.sort_button' | t }}</span>
              </button>
            </noscript>
          {%- endif -%}
        </div>
      {% endif %}

      {% if results.current_vendor or results.current_type %}
        <input
          type="hidden"
          name="q"
          value="{{ results.current_vendor }}{{ results.current_type }}"
        >
      {% endif %}
    </form>
  </facet-filters-form>

  <menu-drawer class="mobile-facets__wrapper" data-breakpoint="tablet">
    <details class="disclosure-has-popup large-up-hide">
      <summary>
        <span class="mobile-facets__open button button--primary button--primary-size focus-inset">
          {% render 'icon-filter' %}
          <span>
            {%- if enable_filtering and enable_sorting -%}
              {{ 'products.facets.filter_and_sort' | t }}
            {%- elsif enable_filtering -%}
              {{ 'products.facets.filter_button' | t }}
            {%- elsif enable_sorting -%}
              {{ 'products.facets.sort_button' | t }}
            {%- endif -%}
          </span>
          <div class="count-bubble">
            {%- if total_active_values > 0 -%}
              {{ total_active_values }}
            {%- endif -%}
          </div>
        </span>
        <span
          tabindex="0"
          class="mobile-facets__close mobile-facets__close--no-js modal-close-button focus-inset"
        >
        </span>
      </summary>
      <facet-filters-form>
        <form id="FacetFiltersFormMobile" class="mobile-facets">
          <div class="mobile-facets__inner">
            <div class="mobile-facets__header">
              <div class="mobile-facets__header-inner">
                <h3 class="mobile-facets__heading">
                  {%- if enable_filtering and enable_sorting -%}
                    {{ 'products.facets.filter_and_sort' | t }}
                  {%- elsif enable_filtering -%}
                    {{ 'products.facets.filter_button' | t }}
                  {%- elsif enable_sorting -%}
                    {{ 'products.facets.sort_button' | t }}
                  {%- endif -%}
                </h3>
                <p class="mobile-facets__count">
                  {%- if is_search -%}
                    {{- 'products.facets.product_count_simple' | t: count: results.results_count -}}
                  {%- else -%}
                    {%- if results.products_count == results.all_products_count -%}
                      {{- 'products.facets.product_count_simple' | t: count: results.products_count -}}
                    {%- else -%}
                      {{-
                        'products.facets.product_count'
                        | t: product_count: results.products_count, count: results.all_products_count
                      -}}
                    {%- endif -%}
                  {%- endif -%}
                </p>
                <span class="mobile-facets__header-icon">
                  {%- render 'icon-close' -%}
                </span>
              </div>
            </div>
            <div class="mobile-facets__main">
              <div class="mobile-facets__main-items">
                {% if enable_filtering %}
                  {%- for filter in results.filters -%}
                    {% liquid
                      assign presentation = filter.presentation | default: default_presentation
                    %}
                    {% case filter.type %}
                      {% when 'boolean', 'list' %}
                        {% liquid
                          assign color_swatch = false
                          assign color_trigger = settings.trigger_swatch | append: '<br />' | append: settings.trigger_swatch_other | strip | newline_to_br | split: '<br />'
                          assign name_option = filter.label | handle | strip

                          for item in color_trigger
                            assign item_temp = item | handle | strip
                            if name_option == item_temp
                              assign color_swatch = true
                            endif
                          endfor
                        %}
                        <details
                          id="Details-Mobile-{{ forloop.index }}-{{ section.id }}"
                          class="mobile-facets__details js-filter"
                          data-index="mobile-{{ forloop.index }}"
                        >
                          <summary class="mobile-facets__summary">
                            <div>
                              <span>{{ filter.label | escape }}</span>
                              <span class="mobile-facets__arrow no-js-hidden">
                                {%- render 'icon-caret' -%}
                              </span>
                              <noscript>{% render 'icon-caret' %}</noscript>
                            </div>
                          </summary>
                          <div
                            id="FacetMobile-{{ forloop.index }}-{{ section.id }}"
                            class="mobile-facets__submenu"
                          >
                            <button
                              class="mobile-facets__close-button link link--text focus-inset"
                              aria-expanded="true"
                              type="button"
                            >
                              {% render 'icon-caret' %}
                              {{ filter.label | escape }}
                            </button>
                            <div class="mobile-facets__submenu-items">
                              <ul
                                class="mobile-facets__list list-unstyled{% if settings.type_color_swatch == 'custom' and color_swatch %} mobile-facets__list--color{% elsif settings.type_color_swatch == 'standart' and presentation == 'swatch' %} mobile-facets__list--color{% elsif presentation == 'image' %} mobile-facets__list--image{% endif %}"
                                role="list"
                                style="--image_filter_columns: {{ image_filter_columns }};"
                              >
                                {%- for value in filter.values -%}
                                  {% liquid
                                    if settings.type_color_swatch == 'custom' and color_swatch
                                      assign color_value = value.label | handle | strip
                                      assign color_value_custom = color_value
                                      assign has_custom_gradient = false

                                      if settings.custom_colors != blank
                                        assign custom_colors_string = settings.custom_colors | strip
                                        assign custom_colors_obj = custom_colors_string | newline_to_br | split: '<br />'

                                        for obj in custom_colors_obj
                                          assign obj_strip = obj | strip
                                          assign obj_key = obj_strip | split: ':' | first
                                          assign obj_value = obj_strip | split: ':' | last
                                          assign obj_color_name = obj_key | handle | strip

                                          if color_value == obj_color_name
                                            assign obj_color_value = obj_value
                                            if obj_color_value contains 'gradient'
                                              assign has_custom_gradient = true
                                              assign color_value_custom = obj_color_value
                                            else
                                              assign color_value_custom = obj_color_value | strip | remove: '-'
                                            endif
                                            break
                                          endif
                                        endfor
                                      endif
                                    endif

                                    assign swatch_value = null
                                    if presentation == 'swatch'
                                      assign swatch = value.swatch
                                      if swatch.image
                                        assign image_url = swatch.image | image_url: width: 50
                                        assign swatch_value = 'url(' | append: image_url | append: ')'
                                        assign swatch_focal_point = swatch.image.presentation.focal_point
                                      elsif swatch.color
                                        assign swatch_value = 'rgb(' | append: swatch.color.rgb | append: ')'
                                      endif
                                    endif
                                  %}
                                  {% liquid
                                    if color_value_custom == 'white' or color_value_custom == '#fff' or color_value_custom == '#ffffff' or color_value_custom == '255,255,255' or color_value_custom == '255,255,255,1' or swatch_value == 'rgb(255 255 255)'
                                      assign is_white = true
                                    else
                                      assign is_white = false
                                    endif

                                    if color_value_custom == 'black' or color_value_custom == '#000' or color_value_custom == '#000000' or color_value_custom == '0,0,0' or color_value_custom == '0,0,0,1' or swatch_value == 'rgb(0 0 0)'
                                      assign is_black = true
                                    else
                                      assign is_black = false
                                    endif
                                  %}
                                  <li
                                    class="mobile-facets__item list-menu__item {% if settings.type_color_swatch == 'custom' and color_swatch %} mobile-facets__item--color{% elsif settings.type_color_swatch == 'standart' and presentation == 'swatch' %} mobile-facets__item--color{% elsif presentation == 'image' %} mobile-facets__item--image{% endif %}"
                                    {% if settings.type_color_swatch == 'custom' and color_swatch %}
                                      style="--swatch-color: {{ color_value_custom }}"
                                    {% elsif settings.type_color_swatch == 'standart' and presentation == 'swatch' %}
                                      style="--swatch-color: {{ swatch_value }};{% if swatch_focal_point %} --swatch-focal-point: {{ swatch_focal_point }};{% endif %}"
                                    {% endif %}
                                  >
                                    <input
                                      class="mobile-facets__checkbox"
                                      type="checkbox"
                                      name="{{ value.param_name }}"
                                      value="{{ value.value }}"
                                      id="Filter-{{ filter.label | escape }}-mobile-{{ forloop.index }}"
                                      {% if value.active %}
                                        checked
                                      {% endif %}
                                      {% if value.count == 0 and value.active == false %}
                                        disabled
                                      {% endif %}
                                    >
                                    <label
                                      for="Filter-{{ filter.label | escape }}-mobile-{{ forloop.index }}"
                                      class="mobile-facets__label{% if value.count == 0 and value.active == false %} mobile-facets__label--disabled{% endif %}{%- if settings.type_color_swatch == 'custom' and color_swatch %} facet-checkbox facet-checkbox--color{% if has_custom_gradient %} color-gradient{% endif %}{% elsif settings.type_color_swatch == 'standart' and presentation == 'swatch' %} facet-checkbox facet-checkbox--color facet-checkbox--standart{% elsif presentation == 'image' %} facet-checkbox facet-checkbox--image{% endif %}{% if is_white %} color-white{% endif %}{% if is_black %} color-black{% endif %}"
                                      {% if settings.type_color_swatch == 'custom' and color_swatch %}
                                        title="{{- value.label -}}"
                                      {% elsif settings.type_color_swatch == 'standart' and presentation == 'swatch' %}
                                        title="{{- value.label -}}"
                                      {% endif %}
                                    >
                                      <span class="mobile-facets__highlight"></span>
                                      {% if presentation == 'image' %}
                                        <div
                                          class="facets__image-wrapper"
                                          style="--image_filter_ratio: {{ image_filter_ratio }}; --image_filter_fit: {{ image_filter_fit }};"
                                        >
                                          {% liquid
                                            assign width = 1000 | divided_by: image_filter_columns
                                          %}
                                          {% capture sizes %}
                                            calc((100vw - 50px) / {{ image_filter_columns }})
                                          {% endcapture %}
                                          {% if value.image %}
                                            {{
                                              value.image
                                              | image_url: width: value.image.width
                                              | image_tag: class: 'facets__image', alt: value.alt, sizes: sizes
                                            }}
                                          {% endif %}
                                        </div>
                                      {% else %}
                                        <svg
                                          width="20"
                                          height="20"
                                          class="icon icon-checkmark"
                                          viewBox="0 0 20 20"
                                          fill="none"
                                          xmlns="http://www.w3.org/2000/svg"
                                        >
                                          <path d="M8.70186 13.3334L5.55566 10.1872L6.18626 9.55663L8.70186 12.0722L14.1073 6.66675L14.7379 7.29733L8.70186 13.3334Z" fill="currentColor" stroke="currentColor" stroke-width="0.5"/>
                                        </svg>
                                      {% endif %}
                                      <span class="facet-checkbox__label {% if settings.type_color_swatch == 'custom' and color_swatch %} visually-hidden{% elsif settings.type_color_swatch == 'standart' and presentation == 'swatch' %} visually-hidden{% endif %}">
                                        {{ value.label | escape }}
                                      </span>
                                    </label>
                                  </li>
                                {%- endfor -%}
                              </ul>
                            </div>
                            <div class="no-js-hidden mobile-facets__footer">
                              <facet-remove>
                                <a
                                  href="{{ results_url }}"
                                  class="mobile-facets__clear button button--tertiary button--primary-size focus-inset"
                                  aria-label="{{ 'products.facets.clear' | t }}"
                                >
                                  {{- 'products.facets.clear' | t -}}
                                </a>
                              </facet-remove>
                              <button
                                type="button"
                                class="no-js-hidden button button--primary button--primary-size focus-inset"
                                onclick="this.closest('.mobile-facets__wrapper').querySelector('summary').click()"
                              >
                                {{ 'products.facets.apply' | t }}
                              </button>
                              <noscript>
                                <button class="button button--primary button--primary-size focus-inset">
                                  {{ 'products.facets.apply' | t }}
                                </button>
                              </noscript>
                            </div>
                          </div>
                        </details>
                      {% when 'price_range' %}
                        <details
                          id="Details-Mobile-{{ forloop.index }}-{{ section.id }}"
                          class="mobile-facets__details js-filter"
                          data-index="mobile-{{ forloop.index }}"
                        >
                          <summary class="mobile-facets__summary">
                            <div>
                              <span>{{ filter.label | escape }}</span>
                              <span class="mobile-facets__arrow no-js-hidden">
                                {%- render 'icon-caret' -%}
                              </span>
                              <noscript>{% render 'icon-caret' %}</noscript>
                            </div>
                          </summary>
                          <div
                            id="FacetMobile-{{ forloop.index }}-{{ section.id }}"
                            class="mobile-facets__submenu"
                          >
                            <button
                              class="mobile-facets__close-button link link--text focus-inset"
                              aria-expanded="true"
                              type="button"
                            >
                              {% render 'icon-caret' %}
                              {{ filter.label | escape }}
                            </button>
                            <div class="mobile-facets__submenu-items">
                              <price-range class="facets__price">
                                <div class="facets__price-wrapper">
                                  <div class="field-wrapper">
                                    <span class="font-weight-medium">
                                      {{ 'products.facets.from' | t }}
                                    </span>
                                    <div class="field">
                                      <span class="field__currency">
                                        {{- cart.currency.symbol -}}
                                      </span>
                                      <input
                                        class="field__input"
                                        name="{{ filter.min_value.param_name }}"
                                        id="Mobile-Filter-{{ filter.label | escape }}-GTE"
                                        {%- if filter.min_value.value -%}
                                          {%- if uses_comma_decimals -%}
                                            value="{{ filter.min_value.value | money_without_currency | replace: '.', '' | replace: ',', '.' }}"
                                          {%- else -%}
                                            value="{{ filter.min_value.value | money_without_currency | replace: ',', '' }}"
                                          {% endif %}
                                        {% else %}
                                          value="0"
                                        {%- endif -%}
                                        type="number"
                                        placeholder="0"
                                        min="0"
                                        max="{{ filter.range_max | divided_by: 100 | ceil }}"
                                      >
                                    </div>
                                  </div>
                                  <div class="field-wrapper">
                                    <span class="font-weight-medium">
                                      {{ 'products.facets.to' | t }}
                                    </span>
                                    <div class="field">
                                      <span class="field__currency">
                                        {{- cart.currency.symbol -}}
                                      </span>
                                      <input
                                        class="field__input"
                                        name="{{ filter.max_value.param_name }}"
                                        id="Mobile-Filter-{{ filter.label | escape }}-LTE"
                                        {%- if filter.max_value.value -%}
                                          {%- if uses_comma_decimals -%}
                                            value="{{ filter.max_value.value | money_without_currency | replace: '.', '' | replace: ',', '.' }}"
                                          {%- else -%}
                                            value="{{ filter.max_value.value | money_without_currency | replace: ',', '' }}"
                                          {% endif %}
                                        {% else %}
                                          value="{{ current_price_max }}"
                                        {%- endif -%}
                                        type="number"
                                        placeholder="{{ filter.range_max | divided_by: 100 | ceil }}"
                                        min="0"
                                        max="{{ filter.range_max | divided_by: 100 | ceil }}"
                                      >
                                    </div>
                                  </div>
                                </div>
                                <div
                                  class="facets__range"
                                  style="--range-min: {{ range_min }}%; --range-max: {{ range_max }}%"
                                >
                                  <label
                                    class="visually-hidden"
                                    for="Filter-{{ filter.label | escape }}-Min-mobile"
                                  >
                                    {{ 'products.facets.from' | t }}
                                  </label>
                                  <input
                                    type="range"
                                    value="{{ current_price_min }}"
                                    min="0"
                                    max="{{ max_price }}"
                                    class="field__range"
                                    id="Filter-{{ filter.label | escape }}-Min-mobile"
                                  >
                                  <label
                                    class="visually-hidden"
                                    for="Filter-{{ filter.label | escape }}-Max-mobile"
                                  >
                                    {{ 'products.facets.to' | t }}
                                  </label>
                                  <input
                                    type="range"
                                    value="{{ current_price_max }}"
                                    min="0"
                                    max="{{ max_price }}"
                                    class="field__range"
                                    id="Filter-{{ filter.label | escape }}-Max-mobile"
                                  >
                                </div>
                              </price-range>
                            </div>

                            <div class="no-js-hidden mobile-facets__footer">
                              <facet-remove>
                                <a
                                  href="{{ results_url }}"
                                  class="mobile-facets__clear button button--tertiary button--primary-size focus-inset"
                                  aria-label="{{ 'products.facets.clear' | t }}"
                                >
                                  {{- 'products.facets.clear' | t -}}
                                </a>
                              </facet-remove>
                              <button
                                type="button"
                                class="no-js-hidden button button--primary button--primary-size focus-inset"
                                onclick="this.closest('.mobile-facets__wrapper').querySelector('summary').click()"
                              >
                                {{ 'products.facets.apply' | t }}
                              </button>
                              <noscript>
                                <button class="button button--primary button--primary-size focus-inset">
                                  {{ 'products.facets.apply' | t }}
                                </button>
                              </noscript>
                            </div>
                          </div>
                        </details>
                    {% endcase %}
                  {%- endfor -%}
                {% endif %}

                {%- if enable_sorting -%}
                  <div
                    class="mobile-facets__details js-filter"
                    data-index="mobile-{{ forloop.index }}"
                  >
                    <div class="mobile-facets__summary">
                      <div class="mobile-facets__sort">
                        <label for="SortBy-mobile">
                          {{- 'products.facets.sort_by_label' | t -}}
                        </label>
                        <div class="select field">
                          <select
                            name="sort_by"
                            class="select__select"
                            id="SortBy-mobile"
                            aria-describedby="a11y-refresh-page-message"
                          >
                            {%- for option in results.sort_options -%}
                              <option
                                value="{{ option.value | escape }}"
                                {% if option.value == sort_by %}
                                  selected="selected"
                                {% endif %}
                              >
                                {{ option.name | escape }}
                              </option>
                            {%- endfor -%}
                          </select>
                          {% render 'icon-caret' %}
                        </div>
                      </div>
                    </div>
                  </div>
                {%- endif -%}

                <div class="mobile-facets__footer">
                  <facet-remove>
                    <a
                      href="{{ results_url }}"
                      class="mobile-facets__clear button button--tertiary button--primary-size focus-inset"
                      aria-label="{{ 'products.facets.clear_all' | t }}"
                    >
                      {{- 'products.facets.clear_all' | t -}}
                    </a>
                  </facet-remove>
                  <button
                    type="button"
                    class="no-js-hidden button button--primary button--primary-size focus-inset"
                    onclick="this.closest('.mobile-facets__wrapper').querySelector('summary').click()"
                  >
                    {{ 'products.facets.apply' | t }}
                  </button>
                  <noscript>
                    <button class="button button--primary focus-inset">
                      {{ 'products.facets.apply' | t }}
                    </button>
                  </noscript>
                </div>
              </div>
            </div>

            {% if results.current_vendor or results.current_type %}
              <input
                type="hidden"
                name="q"
                value="{{ results.current_vendor }}{{ results.current_type }}"
              >
            {% endif %}

            {%- if results.terms -%}
              <input
                type="hidden"
                name="q"
                value="{{ results.terms | escape }}"
              >
              <input name="options[prefix]" type="hidden" value="last">
            {%- endif -%}
          </div>
        </form>
      </facet-filters-form>
    </details>
  </menu-drawer>

  <div class="active-facets active-facets-mobile large-up-hide">
    {%- for filter in results.filters -%}
      {%- for value in filter.active_values -%}
        <facet-remove>
          <a
            href="{{ value.url_to_remove }}"
            class="active-facets__button focus-inset"
            aria-label="{{ 'products.facets.reset' | t }}"
          >
            <span class="active-facets__button-inner">
              <span>{{ filter.label }}:</span>
              {{ value.label | escape }}
              <span class="active-facets__button-close">
                {%- render 'icon-close' -%}
              </span>
              <span class="visually-hidden">
                {{- 'products.facets.clear_filter' | t -}}
              </span>
            </span>
          </a>
        </facet-remove>
      {%- endfor -%}

      {%- if filter.type == 'price_range' -%}
        {%- if filter.min_value.value != null or filter.max_value.value != null -%}
          <facet-remove>
            <a
              href="{{ filter.url_to_remove }}"
              class="active-facets__button focus-inset"
              aria-label="{{ 'products.facets.reset' | t }}"
            >
              <span class="active-facets__button-inner">
                <span>{{ filter.label }}:</span>
                {%- if filter.min_value.value -%}
                  {{ filter.min_value.value | money }}
                {%- else -%}
                  {{ 0 | money }}
                {%- endif -%}
                -&nbsp;
                {%- if filter.max_value.value -%}
                  {{ filter.max_value.value | money }}
                {%- else -%}
                  {{ filter.range_max | money }}
                {%- endif -%}
                <span class="active-facets__button-close">
                  {%- render 'icon-close' -%}
                </span>
                <span class="visually-hidden">
                  {{- 'products.facets.clear_filter' | t -}}
                </span>
              </span>
            </a>
          </facet-remove>
        {%- endif -%}
      {%- endif -%}
    {%- endfor -%}

    {% if active_facets %}
      <facet-remove>
        <a
          href="{{ results_url }}"
          class="facets__reset button button--small button--tertiary focus-inset"
          aria-label="{{ 'products.facets.clear_all' | t }}"
        >
          <span>{{ 'products.facets.clear_all' | t }}</span>
        </a>
      </facet-remove>
    {% endif %}
  </div>

  <span id="ProductCount" class="visibility-hidden">
    {%- if is_search -%}
      {{- 'products.facets.product_count_simple' | t: count: results.results_count -}}
    {%- else -%}
      {%- if results.products_count == results.all_products_count -%}
        {{- 'products.facets.product_count_simple' | t: count: results.products_count -}}
      {%- else -%}
        {{-
          'products.facets.product_count'
          | t: product_count: results.products_count, count: results.all_products_count
        -}}
      {%- endif -%}
    {%- endif -%}
  </span>
</div>
