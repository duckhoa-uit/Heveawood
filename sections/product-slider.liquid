{{ 'section-product-slider.css' | asset_url | stylesheet_tag }}
{{ 'component-badge.css' | asset_url | stylesheet_tag }}
{{ 'component-price.css' | asset_url | stylesheet_tag }}
{{ 'component-card-slider.css' | asset_url | stylesheet_tag }}
<script src="{{ 'product-slider.js' | asset_url }}" defer="defer"></script>

{% style %}
  {% render 'section-margin' %}
{% endstyle %}

{% liquid
  assign slide_effects = section.settings.slide_effects
  assign slideshow_speed = section.settings.slideshow_speed
  assign autoplay = section.settings.is_autoplay
  assign loop = false
  assign stop_autoplay = section.settings.is_hover_stop_autoplay
  assign slideshow_delay = section.settings.slideshow_delay
  assign aspect_ratio = section.settings.aspect_ratio
  assign product_aspect_ratio = section.settings.product_aspect_ratio
  assign product_object_fit = section.settings.product_object_fit
  assign section_size = section.settings.section_size
  assign adapt_aspect_ratio = nil
  assign animation_speed = slideshow_speed | times: 0.5
%}

<div
  class="product-slideshow"
  data-id="shopify-section-{{ section.id }}"
  data-autoplay="{{ autoplay }}"
  data-stop-autoplay="{{ stop_autoplay }}"
  data-speed="{{ slideshow_speed }}"
  data-delay="{{ slideshow_delay }}"
  data-effect="{{ slide_effects }}"
  data-loop="{{ loop }}"
  data-slide-count="{{ section.blocks.size }}"
  style="--product-card-height: calc(11.9rem / ({{ product_aspect_ratio | replace: '/', ' / ' }}) + 4.6rem);"
>
  <div class="{% if section_size == "container" %}container product-slideshow__container{% endif %}">
    {% for block in section.blocks %}
      {% liquid
        if aspect_ratio == 'adapt' and block.settings.image.aspect_ratio != blank
          if adapt_aspect_ratio == nil or block.settings.image.aspect_ratio < adapt_aspect_ratio
            assign adapt_aspect_ratio = block.settings.image.aspect_ratio
          endif
        endif
      %}
    {% endfor %}
    {% style %}
      #shopify-section-{{ section.id }} .product-slideshow-slide {
        {% if aspect_ratio != 'adapt' and aspect_ratio != 'large' %}
          --aspect-ratio: {{ aspect_ratio }};
        {% elsif aspect_ratio == 'adapt' and adapt_aspect_ratio != nil %}
          --aspect-ratio: {{ adapt_aspect_ratio }};
        {% endif %}
      }
    {% endstyle %}
    <div class="product-slideshow-slide color-{{ section.settings.color_scheme }} {{ aspect_ratio }}">
      <div class="product-slideshow-slide__container">
        <div class="product-slideshow-slide__inner{% if section_size != "container" %} container section-full-screen{% endif %}">
          <div class="product-slideshow-item__container">
            <div class="product-slideshow-item__wrapper">
              <div class="product-slideshow-item swiper">
                <div class="product-slideshow-item__swiper-wrapper swiper-wrapper">
                  {% for block in section.blocks %}
                    {%- if block.settings.product != blank -%}
                      <div
                        class="product-slideshow-item__slide swiper-slide{% if forloop.index == 1%} swiper-slide-active{% endif%}"
                        {{ block.shopify_attributes }}
                      >
                        {% render 'product-card-slider',
                          product_card_product: block.settings.product,
                          media_size: product_aspect_ratio,
                          media_fit: product_object_fit,
                          show_vendor: section.settings.show_vendor,
                          section_id: section.id,
                          forloop: forloop
                        %}
                      </div>
                    {%- else -%}
                      <div class="product-slideshow-item__slide swiper-slide color-{{ section.settings.color_scheme }}">
                        {% render 'product-card-slider',
                          media_size: product_aspect_ratio,
                          show_vendor: section.settings.show_vendor,
                          forloop: forloop
                        %}
                      </div>
                    {%- endif -%}
                  {% endfor %}
                </div>
                {% if section.blocks.size > 1 %}
                  <div class="product-slideshow-item__controls color-{{ section.settings.color_scheme }} no-js-hidden">
                    {% if section.settings.show_bullets %}
                      <div class="swiper-pagination"></div>
                    {% endif %}
                    {% if section.settings.show_arrows %}
                      <div class="swiper-buttons">
                        <div class="swiper-button swiper-button-prev">
                          <span>{% render 'icon-arrow' %}</span>
                        </div>
                        <div class="swiper-button swiper-button-next">
                          <span>{% render 'icon-arrow' %}</span>
                        </div>
                      </div>
                    {% endif %}
                  </div>
                {% endif %}
              </div>
            </div>
          </div>
        </div>
        <div class="product-slideshow-media swiper">
          <div class="product-slideshow-media__swiper-wrapper swiper-wrapper">
            {% for block in section.blocks %}
              <div
                class="product-slideshow-media__swiper-slide swiper-slide"
                {{ block.shopify_attributes }}
              >
                <div class="product-slideshow-media__container{% if section_size != "container" %} container section-full-screen{% endif %}">
                  <div class="product-slideshow-media__inner">
                    <div class="product-slideshow-media__content">
                      {% if block.settings.subheading != blank %}
                        <div
                          class="subheading product-slideshow-media__subheading"
                          data-animate="bottom"
                          style="transition-delay: {{ animation_speed | times: 1.8 }}s"
                        >
                          {{ block.settings.subheading }}
                        </div>
                      {% endif %}
                      {% if block.settings.heading != blank %}
                        <h1
                          class="product-slideshow-media__title {{ block.settings.heading_size }}"
                          data-animate="bottom"
                          style="transition-delay: {{ animation_speed | times: 1.3 }}s"
                        >
                          {{ block.settings.heading }}
                        </h1>
                      {% endif %}
                      {% if block.settings.text != blank %}
                        <div
                          class="product-slideshow-media__desc richtext__content"
                          data-animate="bottom"
                          style="transition-delay: {{ animation_speed | times: 1.3 }}s"
                        >
                          {{ block.settings.text }}
                        </div>
                      {% endif %}
                      {% if block.settings.primary_button_label != blank or block.settings.secondary_button_label != blank %}
                        <div class="product-slideshow-media__buttons-wrapper{% if block.settings.secondary_button_label != blank %} product-slideshow-media__buttons-wrapper--padding{% endif %}">
                          <div
                            class="product-slideshow-media__buttons"
                            data-animate="bottom"
                            style="transition-delay: {{ animation_speed | times: 1.8 }}s"
                          >
                            {% if block.settings.primary_button_label != blank %}
                              {%
                                render 'button',
                                btn_label: block.settings.primary_button_label,
                                btn_link: block.settings.primary_button_link,
                                btn_size: 'primary',
                                btn_style: 'primary',
                              %}
                            {% endif %}
                            {% if block.settings.secondary_button_label != blank %}
                              {% render 'button',
                                btn_label: block.settings.secondary_button_label,
                                btn_link: block.settings.secondary_button_link,
                                btn_size: 'primary',
                                btn_style: 'tertiary'
                              %}
                            {% endif %}
                          </div>
                        </div>
                      {% endif %}
                    </div>
                    <div
                      class="product-item-plug"
                      style="min-height: var(--product-card-height);"
                    ></div>
                  </div>
                </div>
                {% if block.settings.overlay_enable %}
                  <div
                    class="product-slideshow-media__overlay"
                    style="--slide-overlay: {{ block.settings.overlay_opacity }}"
                  ></div>
                {% endif %}
                <div class="product-slideshow-media__img{% if block.settings.image == blank %} image-slider-placeholder{% endif %}">
                  {% if block.settings.image != blank %}
                    {% liquid
                      assign width_adapt_ratio = 1
                      if block.settings.image.width > block.settings.image.height
                        assign width_adapt_ratio = 650 | times: block.settings.image.aspect_ratio | round: 2
                      endif
                    %}
                    {% capture sizes %}
                      (min-width: 1200px) 100vw, 
                      {% if width_adapt_ratio != 1 %}
                        {{ width_adapt_ratio }}px
                      {% else %}
                        100vw
                      {% endif %}
                    {% endcapture %}
                    {{
                      block.settings.image
                      | image_url: width: 3840
                      | image_tag:
                        loading: 'lazy',
                        width: block.settings.image.width,
                        height: image_height,
                        sizes: sizes,
                        widths: '375, 550, 750, 1100, 1500, 1780, 2000, 3000, 3840'
                    }}
                  {% else %}
                    {% assign placeholder_index = forloop.index | modulo: 3 | plus: 1 %}
                    {{ 'product-apparel-' |  append: placeholder_index | placeholder_svg_tag }}
                  {% endif %}
                </div>
              </div>
            {% endfor %}
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<script>
  {% if section.blocks.size == 1 %}
    loopedSlides = 1;
  {% elsif section.blocks.size == 2 %}
    loopedSlides = 2;
  {% else %}
    loopedSlides = 3;
  {% endif %}
  document.addEventListener('shopify:section:load', function () {
    {% if section.blocks.size == 1 %}
      loopedSlides = 1;
    {% elsif section.blocks.size == 2 %}
      loopedSlides = 2;
    {% else %}
      loopedSlides = 3;
    {% endif %}
  });
</script>

{% schema %}
{
  "name": "t:sections.product-slider.name",
  "tag": "section",
  "class": "product-slideshow-section spaced-section",
  "enabled_on": {
    "templates": ["*"]
  },
  "settings": [
    {
      "type": "color_scheme",
      "id": "color_scheme",
      "default": "background-3",
      "label": "t:sections.all.color_scheme.label"
    },
    {
      "type": "select",
      "id": "section_size",
      "default": "container",
      "label": "t:sections.all.section_size.label",
      "options": [
        {
          "value": "full",
          "label": "t:sections.all.section_size.options.options__1.label"
        },
        {
          "value": "container",
          "label": "t:sections.all.section_size.options.options__2.label"
        }
      ]
    },
    {
      "type": "header",
      "content": "t:sections.all.image.header.content"
    },
    {
      "type": "select",
      "id": "aspect_ratio",
      "default": "adapt",
      "label": "t:sections.product-slider.settings.background_aspect_ratio.label",
      "info": "t:sections.all.image.aspect_ratio.info",
      "options": [
        {
          "value": "1/1",
          "label": "t:sections.all.image.aspect_ratio.options__1.label"
        },
        {
          "value": "3/2",
          "label": "t:sections.all.image.aspect_ratio.options__2.label"
        },
        {
          "value": "3/4",
          "label": "t:sections.all.image.aspect_ratio.options__3.label"
        },
        {
          "value": "4/3",
          "label": "t:sections.all.image.aspect_ratio.options__4.label"
        },
        {
          "value": "16/9",
          "label": "t:sections.all.image.aspect_ratio.options__5.label"
        },
        {
          "value": "21/9",
          "label": "t:sections.all.image.aspect_ratio.options__6.label"
        },
        {
          "value": "adapt",
          "label": "t:sections.all.image.aspect_ratio.options__7.label"
        },
        {
          "value": "large",
          "label": "t:sections.all.image.aspect_ratio.options__8.label"
        }
      ]
    },
    {
      "type": "header",
      "content": "t:sections.all.card.header_card.content"
    },
    {
      "type": "checkbox",
      "id": "show_vendor",
      "default": true,
      "label": "t:sections.all.card.show_vendor.label"
    },
    {
      "type": "select",
      "id": "product_aspect_ratio",
      "default": "3/4",
      "label": "t:sections.all.image.ratio.label_secondary",
      "options": [
        {
          "value": "3/2",
          "label": "t:sections.all.image.ratio.options__1.label"
        },
        {
          "value": "3/4",
          "label": "t:sections.all.image.ratio.options__2.label"
        },
        {
          "value": "1/1",
          "label": "t:sections.all.image.ratio.options__3.label"
        }
      ]
    },
    {
      "type": "select",
      "id": "product_object_fit",
      "default": "cover",
      "label": "t:sections.all.image.fit.label_secondary",
      "info": "t:sections.product-slider.settings.product_object_fit.info",
      "options": [
        {
          "value": "contain",
          "label": "t:sections.all.image.fit.options__1.label"
        },
        {
          "value": "cover",
          "label": "t:sections.all.image.fit.options__2.label"
        }
      ]
    },
    {
      "type": "header",
      "content": "t:sections.all.slider_options.header.content"
    },
    {
      "type": "checkbox",
      "id": "is_autoplay",
      "default": false,
      "label": "t:sections.all.slider_options.slider_is_autoplay.label"
    },
    {
      "type": "checkbox",
      "id": "is_hover_stop_autoplay",
      "default": true,
      "label": "t:sections.all.slider_options.slider_hover_autoplay_stop.label"
    },
    {
      "type": "checkbox",
      "id": "show_arrows",
      "default": true,
      "label": "t:sections.all.slider_options.navigation.label"
    },
    {
      "type": "checkbox",
      "id": "show_bullets",
      "default": true,
      "label": "t:sections.all.slider_options.pagination.label"
    },
    {
      "type": "range",
      "id": "slideshow_speed",
      "min": 0,
      "max": 6,
      "step": 0.1,
      "default": 1.1,
      "unit": "s",
      "label": "t:sections.all.slider_options.speed.label"
    },
    {
      "type": "range",
      "id": "slideshow_delay",
      "min": 0,
      "max": 8,
      "step": 0.1,
      "default": 3,
      "unit": "s",
      "label": "t:sections.all.slider_options.delay.label"
    },
    {
      "type": "select",
      "id": "slide_effects",
      "options": [
        {
          "value": "slide",
          "label": "t:sections.all.slider_options.effects.options.options__1.label"
        },
        {
          "value": "fade",
          "label": "t:sections.all.slider_options.effects.options.options__2.label"
        },
        {
          "value": "coverflow",
          "label": "t:sections.all.slider_options.effects.options.options__3.label"
        },
        {
          "value": "creative",
          "label": "t:sections.all.slider_options.effects.options.options__4.label"
        },
        {
          "value": "flip",
          "label": "t:sections.all.slider_options.effects.options.options__5.label"
        }
      ],
      "default": "slide",
      "label": "t:sections.all.slider_options.effects.label"
    },
    {
      "type": "header",
      "content": "t:sections.all.section-margin.header.content"
    },
    {
      "type": "select",
      "id": "margin_top",
      "options": [
        {
          "value": "no-indent",
          "label": "t:sections.all.section-margin.options__1.label"
        },
        {
          "value": "xs",
          "label": "t:sections.all.section-margin.options__2.label"
        },
        {
          "value": "s",
          "label": "t:sections.all.section-margin.options__3.label"
        },
        {
          "value": "m",
          "label": "t:sections.all.section-margin.options__4.label"
        },
        {
          "value": "l",
          "label": "t:sections.all.section-margin.options__5.label"
        },
        {
          "value": "xl",
          "label": "t:sections.all.section-margin.options__6.label"
        }
      ],
      "default": "s",
      "label": "t:sections.all.section-margin.margin_top.label"
    },
    {
      "type": "select",
      "id": "margin_bottom",
      "options": [
        {
          "value": "no-indent",
          "label": "t:sections.all.section-margin.options__1.label"
        },
        {
          "value": "xs",
          "label": "t:sections.all.section-margin.options__2.label"
        },
        {
          "value": "s",
          "label": "t:sections.all.section-margin.options__3.label"
        },
        {
          "value": "m",
          "label": "t:sections.all.section-margin.options__4.label"
        },
        {
          "value": "l",
          "label": "t:sections.all.section-margin.options__5.label"
        },
        {
          "value": "xl",
          "label": "t:sections.all.section-margin.options__6.label"
        }
      ],
      "default": "s",
      "label": "t:sections.all.section-margin.margin_bottom.label"
    }
  ],
  "blocks": [
    {
      "type": "product-slider_item",
      "name": "t:sections.product-slider.blocks.name",
      "limit": 8,
      "settings": [
        {
          "type": "product",
          "id": "product",
          "label": "t:sections.all.card.product.label"
        },
        {
          "type": "image_picker",
          "id": "image",
          "label": "t:sections.all.image.label"
        },
        {
          "type": "text",
          "id": "subheading",
          "label": "t:sections.all.subheading.label",
          "default": "t:sections.product-slider.blocks.settings.subheading.default"
        },
        {
          "type": "text",
          "id": "heading",
          "label": "t:sections.all.heading.label",
          "default": "t:sections.product-slider.blocks.settings.heading.default"
        },
        {
          "type": "select",
          "id": "heading_size",
          "options": [
            {
              "value": "h4",
              "label": "t:sections.all.heading_size.options__4.label"
            },
            {
              "value": "h3",
              "label": "t:sections.all.heading_size.options__1.label"
            },
            {
              "value": "h2",
              "label": "t:sections.all.heading_size.options__2.label"
            },
            {
              "value": "h1",
              "label": "t:sections.all.heading_size.options__3.label"
            }
          ],
          "default": "h2",
          "label": "t:sections.all.heading_size.label"
        },
        {
          "type": "inline_richtext",
          "id": "text",
          "label": "t:sections.all.text.label"
        },
        {
          "type": "header",
          "content": "t:sections.all.button.header_button_primary.content"
        },
        {
          "type": "text",
          "id": "primary_button_label",
          "default": "t:sections.product-slider.blocks.settings.primary_button_label.default",
          "label": "t:sections.all.button.button_label.label",
          "info": "t:sections.all.button.button_label.info"
        },
        {
          "type": "url",
          "id": "primary_button_link",
          "label": "t:sections.all.button.button_link.label"
        },
        {
          "type": "header",
          "content": "t:sections.all.button.header_button_secondary.content"
        },
        {
          "type": "text",
          "id": "secondary_button_label",
          "label": "t:sections.all.button.button_label.label",
          "info": "t:sections.all.button.button_label.info"
        },
        {
          "type": "url",
          "id": "secondary_button_link",
          "label": "t:sections.all.button.button_link.label"
        },
        {
          "type": "header",
          "content": "t:sections.all.overlay.header.content"
        },
        {
          "type": "checkbox",
          "id": "overlay_enable",
          "default": true,
          "label": "t:sections.all.overlay.overlay_enable.label"
        },
        {
          "type": "range",
          "id": "overlay_opacity",
          "min": 0,
          "max": 1,
          "step": 0.1,
          "default": 0.2,
          "label": "t:sections.all.overlay.overlay_opacity.label"
        }
      ]
    }
  ],
  "presets": [
    {
      "name": "t:sections.product-slider.name",
      "blocks": [
        {
          "type": "product-slider_item"
        },
        {
          "type": "product-slider_item"
        },
        {
          "type": "product-slider_item"
        }
      ]
    }
  ]
}
{% endschema %}
